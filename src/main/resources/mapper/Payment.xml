<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mybatis.mapper.PaymentMapper">
    <insert id="paymentInsert" parameterType="java.util.Map">
        INSERT INTO PAYMENT_TEST(PAYMENT_PK, MERCHANT_UID, PG_PROVIDER, PAID_AT, STATUS, PG_TID,
                                 BUYER_NAME, BUYER_TEL, PAID_AMOUNT, IMP_UID, NAME)
        VALUES(PAYMENT_PK_SEQ.NEXTVAL, #{merchant_uid}, #{pg_provider}, #{paid_at},
               #{status}, #{pg_tid}, #{buyer_name}, #{buyer_tel}, #{paid_amount}, #{imp_uid}, #{name})
    </insert>

    <select id="paymentList" parameterType="map"  resultType = "map">
        select payment_pk, merchant_uid, pg_provider, paid_at, status,
        pg_tid , buyer_name, buyer_tel, paid_amount, imp_uid, name from payment_test
        LEFT JOIN master_test ON payment_test.buyer_name = master_test.master_nm
        <where>
            <if test="payment_pk!=null">AND payment_pk=#{payment_pk}</if>
            <if test="gubun!=null">
                <choose>
                    <when test="gubun.equals('buyer_name')">
                        AND master_test.master_nm LIKE '%' || #{keyword} || '%'
                    </when>
                    <when test='gubun.equals("buyer_tel")'>
                        AND buyer_tel LIKE '%'||#{keyword}||'%'
                    </when>
                </choose>
            </if>
        </where>
        order by payment_pk desc
    </select>

</mapper>