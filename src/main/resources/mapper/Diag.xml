<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.DiagMapper">
    <resultMap id="DiagMap" type="java.util.HashMap">
        <result column="BOOKING_DATE" property="bookingDate"/>
        <result column="ANIMAL_SPECIES" property="animalSpecies"/>
        <result column="MASTER_NM" property="masterNM"/>
        <result column="MASTER_PNUMBER" property="masterPhoneNumber"/>
        <result column="ANIMAL_NM" property="animalNM"/>
        <result column="DIAG_PK" property="diagPk"/>
        <result column="COMMON_CODE_NM" property="commonCodeName"/>
        <result column="BOOKING_START" property="bookingStart"/>
        <result column="MASTER_EMAIL" property="masterEmail"/>
        <result column="MASTER_ADDRESS" property="masterAddress"/>
        <result column="ANIMAL_BREED" property="animalBreed"/>
        <result column="ANIMAL_SEX" property="animalSex"/>
        <result column="ANIMAL_NEUT" property="animalNeut"/>
        <result column="ANIMAL_BDATE" property="animalBirthDate"/>
        <result column="BOOKING_PK" property="bookingPk"/>
        <result column="DIAG_PRESCRIPTION" property="diagPrescription"/>
        <result column="DIGESTIVE_SYSTEM" property="digestiveSystem"/>
        <result column="CIRCULATORY_SYSTEM" property="circulatorySystem"/>
        <result column="RESPIRATORY_SYSTEM" property="respiratorySystem"/>
        <result column="NERVOUS_SYSTEM" property="nervousSystem"/>
        <result column="ENDOCRINE_SYSTEM" property="endocrineSystem"/>
        <result column="EYES" property="eyes"/>
        <result column="DERMATOLOGY" property="dermatology"/>
        <result column="ORTHOPEDICS" property="orthopedics"/>
        <result column="ABDOMINAL_SURGERY" property="abdominalSurgery"/>
        <result column="NEUROSURGERY" property="neurosurgery"/>
        <result column="THORACIC_SURGERY" property="thoracicSurgery"/>
        <result column="DENTAL" property="dental"/>
    </resultMap>
    <select id="diagSelect" parameterType="com.example.vet.model.diagVO" resultMap="DiagMap">
        SELECT
        BOOKING_TEST.BOOKING_DATE,
        BOOKING_TEST.BOOKING_START,
        ANIMAL_TEST.ANIMAL_SPECIES,
        MASTER_TEST.MASTER_NM,
        MASTER_TEST.MASTER_PNUMBER,
        MASTER_TEST.MASTER_EMAIL,
        MASTER_TEST.MASTER_ADDRESS,
        ANIMAL_TEST.ANIMAL_NM,
        ANIMAL_TEST.ANIMAL_BREED,
        ANIMAL_TEST.ANIMAL_SEX,
        ANIMAL_TEST.ANIMAL_NEUT,
        ANIMAL_TEST.ANIMAL_BDATE,
        DIAG_TEST.*,
        COMMON_CODE_TEST.COMMON_CODE_NM
        FROM
        DIAG_TEST
        LEFT OUTER JOIN BOOKING_TEST ON DIAG_TEST.BOOKING_PK = BOOKING_TEST.BOOKING_PK
        LEFT OUTER JOIN ANIMAL_TEST ON BOOKING_TEST.ANIMAL_PK= ANIMAL_TEST.ANIMAL_PK
        LEFT OUTER JOIN MASTER_TEST ON ANIMAL_TEST.MASTER_PK = MASTER_TEST.MASTER_PK
        LEFT OUTER JOIN COMMON_CODE_TEST ON COMMON_CODE_TEST.COMMON_CODE_PK = BOOKING_TEST.COMMON_CODE_PK
        <where>
            <if test="diagPk != null">
                DIAG_TEST.DIAG_PK = #{diagPk}
            </if>
            <if test="gubun != null">
                <choose>
                    <when test="gubun == 'masterNm'">
                        AND MASTER_TEST.MASTER_NM=#{keyword}
                    </when>
                    <when test="gubun == 'animalNm'">
                        AND ANIMAL_TEST.ANIMAL_NM=#{keyword}
                    </when>
                </choose>
            </if>
            <if test="species != null">
                <choose>
                    <when test="species == 'dog'">
                        AND ANIMAL.animal_Species='강아지'
                    </when>
                    <when test="species == 'cat'">
                        AND ANIMAL.animal_Species='고양이'
                    </when>
                    <when test="species == 'etc'">
                        AND ANIMAL.animal_Species NOT IN ('강아지', '고양이')
                </when>
                </choose>
            </if>
        </where>
    </select>
    <insert id="diagInsert" parameterType="java.util.Map">
        <if test="diagPk!=null">
            INSERT INTO DIAG_SERVICE_TEST(DIAG_SERVICE_PK, SERVICE_PK, DIAG_PK)
            VALUES(DIAG_SERVICE_PK_SEQ.nextval, #{servicePk}, #{diagPk})

        </if>
        <if test="diagPk==null">
            INSERT INTO DIAG_TEST(DIAG_PK, DIAG_PRESCRIPTION, BOOKING_PK, DIGESTIVE_SYSTEM, CIRCULATORY_SYSTEM, RESPIRATORY_SYSTEM, NERVOUS_SYSTEM, ENDOCRINE_SYSTEM, EYES, DERMATOLOGY, ORTHOPEDICS, ABDOMINAL_SURGERY, NEUROSURGERY, THORACIC_SURGERY, DENTAL)
            VALUES (DIAG_PK_SEQ.nextval,'' , #{bookingPk}, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
        </if>
    </insert>
    <select id="serviceCost" parameterType="int" resultType="int">
        SELECT SERVICE_PRICE
        FROM SERVICE_TEST
        WHERE SERVICE_PK=#{servicePk}
    </select>
    <update id="diagUpdate" parameterType="java.util.Map">
        UPDATE DIAG_TEST
        SET DIAG_PRESCRIPTION =
        <choose>
            <when test="diagPrescription != null">
                #{diagPrescription}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>,
        DIGESTIVE_SYSTEM =
        <choose>
            <when test="digestiveSystem != null">
                #{digestiveSystem}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>,
        CIRCULATORY_SYSTEM =
        <choose>
            <when test="circulatorySystem != null">
                #{circulatorySystem}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>,
        RESPIRATORY_SYSTEM =
        <choose>
            <when test="respiratorySystem != null">
                #{respiratorySystem}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>,
        NERVOUS_SYSTEM =
        <choose>
            <when test="nervousSystem != null">
                #{nervousSystem}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>,
        ENDOCRINE_SYSTEM =
        <choose>
            <when test="endocrineSystem != null">
                #{endocrineSystem}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>,
        EYES =
        <choose>
            <when test="eyes != null">
                #{eyes}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>,
        DERMATOLOGY =
        <choose>
            <when test="dermatology != null">
                #{dermatology}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>,
        ORTHOPEDICS =
        <choose>
            <when test="orthopedics != null">
                #{orthopedics}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>,
        THORACIC_SURGERY =
        <choose>
            <when test="thoracicSurgery != null">
                #{thoracicSurgery}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>,
        NEUROSURGERY =
        <choose>
            <when test="neurosurgery != null">
                #{neurosurgery}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>,
        ABDOMINAL_SURGERY =
        <choose>
            <when test="abdominalSurgery != null">
                #{abdominalSurgery}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>,
        DENTAL =
        <choose>
            <when test="dental != null">
                #{dental}
            </when>
            <otherwise>
                '0'
            </otherwise>
        </choose>
        WHERE DIAG_PK = #{diagPk}
    </update>


</mapper>
